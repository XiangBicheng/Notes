# 3.5 数组

- 数组是一种类似于标准库类型vector的数据结构，它也是存放类型相同的对象的容器，但它的大小是确定不变的。因此，数组相较于vector，牺牲了灵活性，提高了性能。**如果不清楚元素的确切个数，请使用vector。**

## 3.5.1 定义和初始化内置数组

- 数组是一种复合类型，数组的声明形如a[d]，其中a是数组的名字，d是数组的维度。编译时维度应该是已知的，所以其必须是一个常量表达式；定义数组的时候必须指定数组的类型，不允许使用auto关键字由初始值的列表推断。和vector一样，数组的元素应为对象，因此不存在引用的数组。

  ```c++
  unsigned cnt = 42; // not a constant expression
  constexpr unsigned sz = 42; // constant expression
  int arr[10]; // array of ten ints
  int *parr[sz]; // array of 42 pointers to int
  string bad[cnt]; // error: cnt is not a constant expression
  string strs[get_size()]; // ok if get_size is constexpr, error otherwise
  ```

- 和内置类型的变量一样，如果**在函数内部**定义了某种内置类型的数组，数组的值将是为定义的。

- **显示初始化**。可以对数组的元素进行列表初始化，此时允许忽略数组的维度；如果提供了数组的维度，维度应该小于等于列表元素的个数。

- **字符数组的特殊性**。字符数组可以使用字符串字面值进行初始化，当使用这种方式时，一定要注意字符串字面值的结尾处还有一个空字符，这个空字符也会被拷贝到字符串数组中去。

- 不能使用数组初始化其他数组或者为其赋值。一些编译器可能支持这样的操作，这是所谓的**编译器扩展**，但一般来说，最好避免使用这样的非标准特性，因为含有非标准特性的程序很可能在其他编译器上无法正常工作。

- **理解复杂的数组声明**。涉及：包含指针的数组、指向数组的指针、数组的引用和包含指针的的数组的引用等。对于复杂的数组声明，按照从内到外，从右到左等原则即可。以`int *(&arry)[10] = ptrs;`为例：首先从内到外，(&arry)表明它是一个引用；然后从右到左，[10]表示引用的对象是包含10个元素的数组，*表明数组中的元素是指针。

  ```
  int *ptrs[10]; // ptrs is an array of ten pointers to int
  int &refs[10] = /* ? */; // error: no arrays of references
  int(*Parray)[10] = &arr; // Parray points to an array of ten ints
  int(&arrRef)[10] = arr; // arrRef refers to an array of ten ints
  ```

## 3.5.2 访问数组元素

- 和标准库类型vector和string一样，数组的元素也能使用range for语句或下标来访问。在使用数组下标的时候，通常将其定义为size_t类型，这时一种机器相关的无符号类型，它被涉及的足够大以便能表示内存中任意大小的对象。

## 3.5.3 指针和数组

- C++数组有一个特性：在很多用到数组名字的地方，编译器都会自动将其替换为一个指向数组首元素的指针。

- 使用标准库函数begin和end可以获取对应数组的首元素指针和尾后指针。

- 数组的下标运算时内置的，与vector的下标运算不同，后者是在对应头文件中定义的。内置的下标运算符所用的索引值不是无符号类型，可以使用负数。并且，只要指针指向的是数组中的元素，都可以指向下标运算。

  ```c++
  int ia[] = {0,2,4,6,8};
  int *p = &ia[2];
  int j = p[1];
  int k = p[-2];
  ```

## 3.5.4 C风格字符串

- 字符串字面量是从C继承而来的，它不是一种类型，而是为了表达和使用字符串而形成的一种约定俗成的写法，最重要的一个特性是它存放在字符数组中并以空字符结束。
- C标准库定义了一组函数用于对这类以空字符结尾的字符数组进行相关的操作，包括拷贝、比较和链接等。

## 3.5.5 与旧代码的接口

- 混用string对象和C风格字符串

- 使用数组初始化vector对象

- **note：现代的C++程序应当尽量使用vector和迭代器，避免使用内置数组和指针；应该尽量使用string，避免使用C风格的基于数组的字符串。**

  